# 1. 쿠버네티스 이해하기

## 컨테이너 인프라 환경
하나의 어플리케이션을 운영하는 것과 달리 수 많은 어플리케이션을 운영해야 한다고 하면 방법은 두가지가 있을 것이다. **가상화 환경과** **컨테이너 인프라 환경** 이다. 

![vm/container](https://user-images.githubusercontent.com/71869837/130013158-cb9e2f09-363c-4305-822e-fdac5c4efc48.png)

지금 까지는 하이퍼바이저 위에 운영체제가 설치된 가상 머신을 여러 대 실행시키고 하나의 머신에 하나의 어플리케이션을 운영하는 **가상화 환경**을 사용했다. 가상 머신 당 독립적인 운영 체제를 가지고 있는 일이 비효율적이지만 **컨테이너 인프라 환경** 을 구축하기에는 기존의 컨테이너 관리 솔루션이 너무 부족한 점이 많았다.

예로 들어 하나의 운영 체제 커널을 공유하기 때문에 그 위에 독립적으로 존재하는 수 많은 컨테이너를 어떻게 관리할 수 있을까? 도커를 통한 배포 경험에서 도커 컴포즈를 이용해 컨테이너 실행 순서나 설정을 파일로 작성할 수 있었지만 그 것도 한계가 있었다. 이런 문제점을 해결해 주는 녀석이 **쿠버네티스다**. 

## 쿠버네티스 구성하기
쿠버네티스를 구축하기 위해 **쿠버네티스 클러스터를** 만들어야 한다. 쿠버네티스 클러스터는 노드로 구성되는데 노드는 하나의 가상 머신이라고 생각하면 된다. 이 노드 중에서 쿠버네티스 클러스터를 전반적으로 담당하는 **마스터 노드와** 실제 어플리케이션이 배포되는 **워커 노드**로 구분할 수 있다. 

### **마스터노드 구성 요소**
* **kubectl**  
쿠버네티스 클러스터에 명령을 내리는 역할을 한다. API 서버와 주로 통신하며 작업을 수행한다.

* **API 서버**  
쿠버네티스 클러스터의 중심 역할을 하는 통로이다. 요청을 분석하고 실행을 위해 여러 요소들과 통신한다. 회사에서 관리자라고 생각하면된다.

* **etcd**  
구성 요소들의 상태 값이 모두 저장되는 곳이다. 회사의 관리자가 모든 보고 내용을 기록하는 노트라고 생각하면 쉽다. 실제로 다른 요소는 상태 값을 저장하지 않는다. 때문에 etcd 의 정보를 가지고 있다면 쿠버네티스 클러스터는 복귀할 수 있다. 

* **컨트롤러 매니저**  
쿠버네티스 클러스터의 오브젝트 상태를 관리한다.
    * 노드 컨트롤러 : 여러 노드의 상태 체그와 복구를 담당한다.
    * 레플리카셋 컨트롤러 : 레플리카셋에 요청받은 파드 개수대로 파드를 생성한다. 
    * 앤드포인트 컨트롤러 : 서비스와 파드를 연결하는 연할을 한다.

* **스케줄러**  
노드의 상태와 자원, 레이블, 요구 조건 등을 고려해 파드를 어떤 노드에 생성할 것인지 결정하고 할당한다. 

### **워커 노드 구성 요소**

* **kubelet**  
파드의 구성 내용(PodSpec)을 받아서 컨테이너 런타임으로 전달하고, 파드 안의 컨테이너들이 정상적으로 작동하는지 모니터링한다.

* **컨테이너 런타임**  
파드를 이루는 컨테이너의 실행을 담당한다. 파드 안에 다양한 종류의 컨테이너가 문제 없이 작동하게 만드는 표준 인터페이스이다. 

* **kube-proxy**  
쿠버네티스 클러스터는 파드가 위치한 노드에 kube-proxy를 통해 파드가 통신할 수 있는 네트워크를 설정한다.  

# 2. 쿠버네티스 기본 사용법 배우기

## 오브젝트 종류
파드(Pod) : 쿠버네티스에서 실행되는 최소 단위. 독립적인 공간과 IP를 가지고 있다. 하나의 파드는 1개 이상의 컨테이너를 갖고 있다. 

네임스페이스(Namespace): 쿠버네티스 클러스터에서 사용되는 리소스들을 구분해 관리하는 그룹 

볼륨(Volume): 파드가 생성 될 때 파드에서 사용할 수 있는 디렉터리를 제공한다. 기본적으로 파드는 쉽게 생성되고 삭제되기 때문에 디렉터리도 임시로 사용하지만 볼륨 오브젝트를 통해 저장과 보존이 가능하게 설정할 수 있다.

서비스(Service): 앞서 말한 것 처럼 파드는 쉽게 생성되고 삭제된다. 때문에 접속 정보가 고정적일 수 없는데 이를 안정적으로 유지하도록 파드 접속을 서비스를 통해 내/외부로 연결된다. 

디플로이먼트(Deployment): 파드에 기반을 두고 있으며 레플리카셋 오브젝트를 합쳐 놓은 형태. 파드의 숫자를 결정하는 replicas 에 맞는 레플리카셋을 관리하는 오브젝트이다. 

데몬셋(Demonset): 디플로이먼트의 replicas가 노드 수 만큼 정해져 있는 형태 즉 노드를 관리하는 파드라면 데몬셋으로 만드는게 가장 효율적이다. 

컨피그맵(ConfigMap): 이름 그대로 설정을 목적으로 사용하는 오브젝트 

스테이트풀셋(StatefulSet): 파드가 무작위로 생성되는 것이 아닌 순서대로 생성되어 고정된 이름, 볼륨, 설정을 가질 수 있는 오브젝트 세션 인증 방식을 예로 들면 여러개의 파드 즉 서버 중 한 곳에서만 사용자의 세션 정보가 있기 때문에 자동으로 로드벨런싱을 해주어 무작위로 파드에 접근하는 것이 아닌 원하는 파드에 접근하도록 한다. 

